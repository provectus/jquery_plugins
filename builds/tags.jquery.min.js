/*! jquery_plugins 2013-08-29 */
!function(){!function(a){return a.constants={keyCodes:{UP:38,DOWN:40,LEFT:37,RIGHT:39,PAGEUP:33,PAGEDOWN:34,SPACE:32,ENTER:13,ESC:27,BACKSPACE:8},monthes:["January","February","March","April","May","June","July","August","September","October","November","December"],daysOfWeek:{"short":["Su","Mo","Tu","We","Th","Fr","Sa"],full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}}}(jQuery)}.call(this),function(){!function(a){return null==a.fn.__old_val?(a.fn.__old_val=a.fn.val,a.fn.val=function(){var a;return a=this.data("custom_val"),null!=a?a.apply(this,arguments):this.__old_val.apply(this,arguments)}):void 0}(jQuery)}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(b){return b.fn.mutations=function(c){var d,e;return e={chlildren:!1,attributes:!1,subtree:!1,filter:[]},c=b.extend(e,c),d=window.MutationObserver||window.MozMutationObserver||window.WebKitMutationObserver,this.each(function(){var e,f;return null!=d?(e=new d(function(a){var c,d,e,f,g,h,i,j,k;k=[];for(d in a)if(e=a[d],g=b(e.target),"childList"===e.type){for(j=e.addedNodes,h=0,i=j.length;i>h;h++)f=j[h],c=b.Event("child_added",{node:f}),g.trigger(c);k.push(function(){var a,d,h,i;for(h=e.removedNodes,i=[],a=0,d=h.length;d>a;a++)f=h[a],c=b.Event("child_removed",{node:f}),i.push(g.trigger(c));return i}())}else"attributes"===e.type?(c=b.Event("attribute_changed",{attribute:e.attributeName,oldValue:e.oldValue}),k.push(g.trigger(c))):k.push(void 0);return k}),f={childList:c.children,attributes:c.attributes,characterData:!1,subtree:c.subtree,attributeOldValue:c.attributes,characterDataOldValue:!1,attributeFilter:c.filter.length?c.filter:void 0},e.observe(this,f)):null!=this.addEventListener&&(c.children===!0&&(this.addEventListener("DOMNodeInserted",b.proxy(function(a){var d;return a.relatedNode===this||a.relatedNode!==this&&c.subtree===!0?(d=b.Event("child_added",{node:a.target}),b(a.relatedNode).trigger(d)):void 0},this)),this.addEventListener("DOMNodeRemoved",function(a){var d;return a.relatedNode===this||a.relatedNode!==this&&c.subtree===!0?(d=b.Event("child_removed",{node:a.target}),b(a.relatedNode).trigger(d)):void 0})),c.attributes===!0)?this.addEventListener("DOMAttrModified",function(d){var e,f;return c.filter.length&&(f=d.attrName,a.call(c.filter,f)>=0)&&(d.srcElement===this||d.srcElement!==this&&c.subtree===!0)?(e=b.Event("attribute_changed",{attribute:d.attrName,oldValue:d.prevValue}),b(d.srcElement).trigger(e)):void 0},!1):void 0})}}(jQuery)}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(b){return b.fn.tags=function(c){var d,e,f;return d={tags:[],tips:[],withId:!1,withDropdown:!1,withNew:!1,async:!1,callback:null},c=b.extend(d,c),f='<div class="s-tags" tabindex="0">                  <div class="s-tags__container">                    <ul class="s-tags__current">                      <li class="s-tags__input-container"><input class="s-tags__input" type="text"></li>                    </ul>                    <div class="placeholder hidden"></div>                   </div>                  <div class="s-tags__dropdown">                    <ul class="s-tags__list">                      <li class="s-tags__item s-tags__new hidden">                        <span class="text"></span>                        <span class="js-tags-new-tag-text">(New tag)</span>                        <button class="close"></button>                      </li>                    </ul>                  </div>                  <div class="s-tags__toggler hidden"></div>                </div>',e='<li class="s-tags__item"><span class="text"></span><button class="close"></button></li>',this.each(function(){var d,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this;for(d=b(this),d.hide(),this.tags=b(f),this.tags.data("values",[]),this.tags.data("ids",[]),this.tags.data("tips",c.tips),d.before(this.tags),l=function(a,b){var c,d,e;for(d=0,e=b.length;e>d;d++)if(c=b[d],a.toLowerCase()===c.name.toLowerCase())return c;return!1},d.data("custom_val",function(a){var e,f,h;if(null!=a){if(Array.isArray(a))for(w.tags.find(".s-tags__current .s-tags__item").each(function(){return m(b(this))}),f=0,h=a.length;h>f;f++)e=a[f],g(e);return d}return c.withId?w.tags.data("ids"):w.tags.data("values").map(function(a){return null!=a&&null!=a.name?a.name:a})}),r=function(d){var e;return w.tags.find(".s-tags__dropdown .s-tags__list .s-tags__item:not(.s-tags__new)").remove(),e=b.Deferred(),b.isFunction(c.callback)?c.async===!0?c.callback(d).done(function(a){return e.resolve(a)}):e.resolve(b.isFunction(c.callback)?c.callback(d):[]):null!=c.tips?e.resolve(c.tips.map(function(a){return 0===a.toLowerCase().trim().indexOf(d.toLowerCase().trim())?a:void 0}).filter(function(a){return a})):e.resolve([]),e.done(function(c){var d,e,f,g,i;for(c=c.map(function(a){return"string"===b.type(a)?{name:a}:a}),w.tags.data("tips",c),e=w.tags.data("values").map(function(a){return"string"===b.type(a)?a:a.name}),f=0,g=c.length;g>f;f++)d=c[f],"object"!=typeof d&&(d={name:d}),i=d.name.toString(),a.call(e,i)<0&&h(d);return q()})},h=function(a){var c,d;return c=w.tags.find(".s-tags__dropdown .s-tags__list"),d=b(e),d.find(".text").text(a.name),null!=a.id&&d.attr("data-id",a.id),c.find(".s-tags__new").before(d)},g=function(f,g,h){var i,j,k,m;if(null==g&&(g=void 0),null==h&&(h=!0),!(h===!0&&c.withNew===!1&&(f=l(f,w.tags.data("tips")),f===!1)||(m=w.tags.data("values"),a.call(m,f)>=0))){if(m.push(f),w.tags.data("values",m),null!=g){if(k=w.tags.data("ids"),!(a.call(k,g)<0))return;k.push(g),w.tags.data("ids",k)}return i=b(e),i.attr("data-id",g),i.find(".text").text("string"===b.type(f)?f:f.name),w.tags.find(".s-tags__current .s-tags__input-container").before(i),j=b.Event("tag_added"),j.tag=f,d.trigger(j)}},m=function(a){var e,f,g,h,i,j,k;return i=w.tags.data("values"),h=a.find(".text").text(),g=i.map(function(a){return"string"===b.type(a)?a:a.name}).indexOf(h),g>-1&&([].splice.apply(i,[g,g-g+1].concat(j=[])),j),w.tags.data("values",i),c.withId&&(f=w.tags.data("ids"),g>-1&&([].splice.apply(f,[g,g-g+1].concat(k=[])),k),w.tags.data("ids",f)),a.remove(),e=b.Event("tag_removed"),e.tag===h,d.trigger(e)},n=function(a){var c,d,e,f,g,h;if(c=w.tags.find(".s-tags__input"),e=b(".js-tags-plugin-size"),!e.size()){for(e=b('<div class="js-tags-plugin-size"></div>').css({position:"absolute",left:-1e3,top:-1e3,visibility:"hidden"}),h=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],f=0,g=h.length;g>f;f++)d=h[f],e.css(d,c.css(d));b("body").append(e)}return e.text(a),c.css("width",e.width()+10)},o=function(){var a,b,c,d,e,f,g;return d=w.tags.find(".s-tags__dropdown .s-tags__list"),a=d.find(".s-tags__item.active"),0!==a.size()?(g=a.position().top,f=d.scrollTop(),b=d.outerHeight(),c=a.outerHeight(),e=6,g>b-c&&d.animate({scrollTop:g+f-b+c+e},"fast"),e>g?d.animate({scrollTop:f+g-e},"fast"):void 0):void 0},q=function(){var a,d;return a=w.tags.find(".s-tags__dropdown .s-tags__list"),a.height()+w.tags.offset().top+w.tags.height()+20>b(document).height()?a.addClass("topped"):a.removeClass("topped"),d=!1,c.withNew&&a.children().length>0?d=!0:a.children().length>1&&(d=!0),d&&(a.addClass("active"),b(".s-tags__toggler").addClass("active")),a},k=function(){return w.tags.find(".s-tags__dropdown .s-tags__list").removeClass("active"),w.tags.find(".s-tags__toggler").removeClass("active")},i=function(){return w.tags.addClass("disabled"),w.tags.find(".s-tags__input").prop("disabled",!0),w.tags.find(".s-tags__current, .close").css("cursor","default")},j=function(){return w.tags.removeClass("disabled"),w.tags.find(".s-tags__input").prop("disabled",!1),w.tags.find(".s-tags__current").css("cursor","text"),w.tags.find(".close").css("cursor","pointer")},v=c.tags,t=0,u=v.length;u>t;t++)s=v[t],null!=s&&"object"===b.type(s)?(h(s.name),g(s.name,s.id,!1)):g(s,void 0,!1);return d.is(":disabled")&&i(),d.attr("placeholder")&&this.tags.find(".placeholder").removeClass("hidden").text(d.attr("placeholder")),c.withDropdown&&this.tags.find(".s-tags__toggler").removeClass("hidden"),(p=function(){var a;return a=b.trim(w.tags.find(".s-tags__input").val()),""===a&&0===w.tags.data("values").length?w.tags.find(".placeholder").removeClass("hidden"):w.tags.find(".placeholder").addClass("hidden")})(),d.mutations({attributes:!0,filter:["disabled"]}),d.on("attribute_changed",function(a){return b(a.target).prop("disabled")?i():j()}),this.tags.on("mousedown",".s-tags__toggler",function(){var a;return a=w.tags.find(".s-tags__dropdown .s-tags__list"),a.hasClass("active")?k():(r(""),q())}),this.tags.on("mousedown",".s-tags__list",function(){return!1}),this.tags.on("mouseenter",".s-tags__dropdown .s-tags__item",function(a){var c;return c=b(a.target),c.closest(".s-tags__list").find(".s-tags__item").removeClass("active"),c.addClass("active")}),this.tags.on("mouseleave",".s-tags__dropdown .s-tags__item",function(a){return b(a.target).closest(".s-tags__list").find(".s-tags__item").removeClass("active")}),this.tags.on("mousedown",".s-tags__dropdown .s-tags__item",function(a){var c,d;return a.preventDefault(),c=b(a.target).closest(".s-tags__item"),g(c.find(".text").text(),c.attr("data-id")),d=b(a.target).closest(".s-tags"),d.find(".s-tags__input").focus().val(""),k(),c.removeClass("active")}),this.tags.on("click",".s-tags__container",function(a){var c;return c=b(a.target).closest(".s-tags"),c.find(".s-tags__input").show().focus()}),this.tags.on("focus",".s-tags__input",function(a){var c,e;return b(a.target).show(),e=b(a.target).closest(".s-tags"),e.addClass("active"),c=b.Event("tags_size_changed"),d.trigger(c)}),this.tags.on("blur",".s-tags__input",function(a){var e,f,h;return h=b(a.target).closest(".s-tags"),h.find(".s-tags__current").children().size()>1&&h.find(".s-tags__input").hide(),h.removeClass("active"),e=b.Event("tags_size_changed"),d.trigger(e),k(),h.find(".s-tags__dropdown .s-tags__item").removeClass("active"),f=b.trim(b(a.target).val()),""!==f?(c.withNew||g(f),b(a.target).val("")):void 0}),this.tags.on("keydown",".s-tags__input",function(a){var c,d,e,f,h,i,j;switch(p(),i=b(a.target).closest(".s-tags"),j=b.trim(b(a.target).val()),e=i.find(".s-tags__list"),""!==j&&q(),d=function(c){var d,f;return f=l(c,i.data("tips")),f!==!1?(c=f.name,d=f.id,""!==c&&(g(c,d),e.find(".s-tags__new .text").text(c),k()),b(a.target).val(""),a.preventDefault()):void 0},a.keyCode){case b.constants.keyCodes.ENTER:return c=i.find(".s-tags__list .s-tags__item.active"),s=c.size()?c.find(".text").text():j,d(s),!1;case b.constants.keyCodes.BACKSPACE:""===j&&m(i.find(".s-tags__current .s-tags__item:last"));break;case b.constants.keyCodes.UP:return""===j?!0:(f=i.find(".s-tags__list .s-tags__item"),c=f.filter(".active"),h=c.size()?c.prev():f.last(),h=h.size()?h:f.last(),f.removeClass("active"),h.addClass("active"),o(),!1);case b.constants.keyCodes.DOWN:return""===j?!0:(f=i.find(".s-tags__list .s-tags__item"),c=f.filter(".active"),h=c.size()?c.next():f.first(),h=h.size()?h:f.first(),f.removeClass("active"),h.addClass("active"),o(),!1)}return n(j)}),this.tags.on("keyup",".s-tags__input",function(d){var e,f,g,h,i;return p(),g=b(d.target).closest(".s-tags"),e=g.find(".s-tags__list"),h=b.trim(b(d.target).val()),f=e.find(".s-tags__new"),a.call(w.tags.data("tips"),h)>=0||a.call(w.tags.data("values"),h)>=0?f.hide():c.withNew&&f.show().removeClass("hidden").find(".text").text(h),n(h),""===h?(k(),e.find(".s-tags__new .js-tags-new-tag-text").hide()):((i=d.keyCode)!==b.constants.keyCodes.UP&&i!==b.constants.keyCodes.DOWN&&r(h),e=q(),c.withNew?e.find(".s-tags__new .js-tags-new-tag-text").show():void 0)}),this.tags.on("click",".s-tags__item .close",function(a){return d.is(":disabled")?!1:(b(a.target).closest(".s-tags").find(".s-tags__input").show().focus(),m(b(a.target).closest(".s-tags__item")))}),d.on("add_tag",function(a,b){return g(b.name,b.id,!1)})})}}(jQuery)}.call(this);